<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css"" rel="stylesheet" />
    <link rel="shortcut icon" type="image/icon-x" href="quill_icon.png"/>
    <link rel="apple-touch-icon" href="quill_icon.png" />

    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <title>Journal</title>
  </head>
  <body>
    <script src="https://www.gstatic.com/firebasejs/7.8.0/firebase-app.js"></script>

    <div id="root"></div>
  </body>
  	<script>
			var config = {
				apiKey: "AIzaSyBljVtRAbzvQMdzIskfxb_HSUrs5vKcNBk",
				authDomain: "react-journal-cf451.firebaseapp.com",
				databaseURL: "https://react-journal-cf451.firebaseio.com",
				projectId: "react-journal-cf451",
				storageBucket: "react-journal-cf451.appspot.com",
				messagingSenderId: "768206838911"
			};
			firebase.initializeApp(config);

			var dbRef = firebase.database().ref('entries');

			dbRef.on('value', gotData, errData);
			// TODO[x]: Format blog div sizes (and inner text size) for Mobile
			// TODO[]: Research most efficient method for Dad to upload new blogs (potentially a web text editor with a user login page)
			// TODO[]: Find a way to take firebase data and CREATE a new file so dad could write once and update site easily
			function gotData(data) {
				// console.log(data.val());

				var journal = data.val();
				var keys = Object.keys(journal);
				console.log(keys);

				for (var i = 0; i < keys.length; i++) {
					var k = keys[i];
          var title = journal[k].title;
          var articleBody = journal[k].articleBody;
          var article = document.createElement("tile");
          article.innerHTML += '<article className="tile is-child box">';
          article.innerHTML += '<p className="title">'+title+'</p>';
          article.innerHTML += articleBody;
          article.innerHTML += '</article>';
          document.getElementById('tileParent').appendChild(article);
				}


			}

			function errData(err) {
				console.log("Error: " +err);
			}

			window.addEventListener('resize', gotData);

	</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const $modal = Array.prototype.slice.call(document.querySelectorAll('.modal'), 0);
    const $delete = Array.prototype.slice.call(document.querySelectorAll('.delete'), 0);
    if ($delete.length > 0)
    {
      $delete.forEach( el => {
        el.addEventListener('click', () => {
          const targetDelete = el.dataset.target;
          const $targetDelete = document.getElementById(targetDelete);

          el.classList.toggle('is-active');
          $targetDelete.classList.toggle('is-active');
          $modal.classList.toggle('is-active');
        });
      });
    }
  });
</script>
<script>
  document.addEventListener("visibilitychange", () => {
  if (document.visibilityState === "visible") {
    fetch(`/index.html?_=${Date.now()}`)
      .then(res => res.text())
      .then(htmlString => {
        let doc = new DOMParser().parseFromString(htmlString, "text/html");
        let latestVersion = doc
          .querySelector("meta[name='app-version']")
          .getAttribute("content");

        if (latestVersion !== currentVersion) {
          window.location.reload(true);
        }
      });
    }
  });
</script>
</html>